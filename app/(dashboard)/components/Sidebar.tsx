"use client";

import Link from "next/link";
import { usePathname } from "next/navigation";
import { supabaseBrowser } from "@/lib/supabaseClient";
import { useState, useEffect } from "react";

export default function Sidebar() {
  const pathname = usePathname();
  const [taskCount, setTaskCount] = useState<number | null>(null);

  useEffect(() => {
    async function fetchTaskCount() {
      const {
        data: { user },
      } = await supabaseBrowser.auth.getUser();
      if (user) {
        const { count } = await supabaseBrowser
          .from("tasks")
          .select("*", { count: "exact", head: true })
          .eq("assignee_id", user.id)
          .neq("status", "complete");
        setTaskCount(count);
      }
    }
    fetchTaskCount();
  }, []);

  const menuItems = [
    {
      name: "My Tasks",
      href: "/",
      icon: "ğŸ“‹",
      badge: taskCount !== null && taskCount > 0 ? taskCount : null,
    },
    {
      name: "All Tasks",
      href: "/all-tasks",
      icon: "ğŸ“",
    },
    {
      name: "Timesheet",
      href: "/timesheet",
      icon: "â±ï¸",
    },
    {
      name: "Projects",
      href: "/projects",
      icon: "ğŸ“",
    },
    {
      name: "Team",
      href: "/team",
      icon: "ğŸ‘¥",
    },
    {
      name: "Settings",
      href: "/settings",
      icon: "âš™ï¸",
    },
  ];

  return (
    <aside className="w-64 bg-zinc-900 border-r border-zinc-800 flex flex-col h-screen">
      <div className="h-16 flex items-center px-6 border-b border-zinc-800">
        <svg xmlns="http://www.w3.org/2000/svg" width="217" height="24" viewBox="0 0 217 24" fill="none" className="h-6 w-auto">
          <g clipPath="url(#clip0_5445_8731)">
            <path d="M208.719 3.06473H207.133V2.47266H210.981V3.06473H209.395V7.31495H208.719V3.06473ZM213.582 7.31495L212.25 3.08587V7.31495H211.573V2.47266H212.715L213.963 6.51142L215.21 2.47266H216.352V7.31495H215.676V3.08587L214.343 7.31495H213.582Z" fill="#F5F5F7" style={{mixBlendMode: "difference"}}/>
            <path d="M24.502 7.464C24.502 3.93272 28.2447 2.05078 31.6703 2.05078C35.413 2.05078 38.4156 3.72127 39.1557 7.76003H35.9416C35.413 5.47633 33.3407 4.86312 31.5857 4.86312C30.1266 4.86312 27.9487 5.47633 27.9487 7.35827C27.9487 8.8173 29.1962 9.53624 30.761 9.85342L33.0447 10.2763C36.3645 10.8895 39.5998 12.1371 39.5998 15.9856C39.5998 19.834 35.7513 21.8006 32.0086 21.8006C27.4412 21.8006 24.4174 19.3054 24.0156 15.1398H27.3354C27.9487 17.7406 29.6191 19.094 32.22 19.094C34.5037 19.094 36.2799 18.0578 36.2799 16.1759C36.2799 14.2094 34.2077 13.575 32.3258 13.2578L30.0421 12.8349C26.9971 12.2429 24.502 10.6781 24.502 7.464Z" fill="#F5F5F7" style={{mixBlendMode: "difference"}}/>
            <path d="M45.1806 3.61719V7.35992H47.993V9.64362H45.1806V17.3405C45.1806 18.7996 45.4978 19.1167 46.8511 19.1167H47.993V21.5062H45.7093C42.6855 21.5062 42.0722 20.6815 42.0722 17.7634V9.53789H40V7.35992H42.0722V3.61719H45.1806Z" fill="#F5F5F7" style={{mixBlendMode: "difference"}}/>
            <path d="M54.5523 21.8017C51.2325 21.8017 49.7734 19.6237 49.7734 16.1981V7.35938H52.8818V15.4581C52.8818 17.3188 53.199 19.2008 55.4827 19.2008C57.8721 19.2008 58.6968 17.34 58.6968 14.8448V7.35938H61.8052V21.4845H58.6968V19.518C57.8721 20.977 56.4131 21.8017 54.5523 21.8017Z" fill="#F5F5F7" style={{mixBlendMode: "difference"}}/>
            <path d="M77.2968 2.36719V21.3769H74.1884V19.6007C73.3637 20.954 71.9047 21.7786 70.0228 21.7786C66.703 21.7786 63.8906 18.8606 63.8906 14.3989C63.8906 9.93723 66.703 7.01917 70.0228 7.01917C71.8836 7.01917 73.3426 7.84384 74.1884 9.19714V2.36719H77.2968ZM67.1047 14.42C67.1047 17.4438 68.5638 19.3046 70.636 19.3046C72.7082 19.3046 74.273 17.7399 74.273 14.42C74.273 11.206 72.7082 9.53547 70.636 9.53547C68.5638 9.53547 67.1047 11.3963 67.1047 14.42Z" fill="#F5F5F7" style={{mixBlendMode: "difference"}}/>
            <path d="M83.4365 5.58298H80.3281V2.47461H83.4365V5.58298ZM83.4365 21.4843H80.3281V7.35919H83.4365V21.4843Z" fill="#F5F5F7" style={{mixBlendMode: "difference"}}/>
            <path d="M92.4881 21.8024C89.0625 21.8024 85.5312 19.5187 85.5312 14.4227C85.5312 9.32667 89.0625 7.04297 92.4881 7.04297C95.9136 7.04297 99.4449 9.32667 99.4449 14.4227C99.4449 19.5187 95.9136 21.8024 92.4881 21.8024ZM96.2097 14.4227C96.2097 11.2086 94.4334 9.53812 92.4669 9.53812C90.5004 9.53812 88.7242 11.1029 88.7242 14.4227C88.7242 17.6368 90.5004 19.3073 92.4669 19.3073C94.4546 19.2016 96.2097 17.6368 96.2097 14.4227Z" fill="#F5F5F7" style={{mixBlendMode: "difference"}}/>
            <path d="M117.522 11.9249C117.522 19.4104 112.955 21.4826 106.928 21.4826H101.727V2.36719H106.928C112.955 2.36719 117.522 4.43943 117.522 11.9249ZM105.046 5.0738V18.7971H106.717C110.354 18.7971 114.097 17.9725 114.097 11.946C114.097 5.91961 110.46 5.0738 106.717 5.0738H105.046Z" fill="#F5F5F7" style={{mixBlendMode: "difference"}}/>
            <path d="M123.015 5.58298H119.906V2.47461H123.015V5.58298ZM123.015 21.4843H119.906V7.35919H123.015V21.4843Z" fill="#F5F5F7" style={{mixBlendMode: "difference"}}/>
            <path d="M132.279 10.3603C130.313 10.3603 129.171 11.185 129.171 13.9973V21.3771H126.062V7.35768H129.171V9.85283C129.89 8.28808 131.243 7.25195 133.019 7.25195C133.231 7.25195 133.633 7.25195 133.844 7.35768V10.4661C133.21 10.4661 132.681 10.3603 132.279 10.3603Z" fill="#F5F5F7" style={{mixBlendMode: "difference"}}/>
            <path d="M140.904 19.1996C142.574 19.1996 143.822 18.5864 144.33 17.2331H147.438C146.825 19.5168 144.626 21.8005 140.989 21.8005C136.421 21.8005 133.82 18.3749 133.82 14.315C133.82 10.0648 136.738 7.04102 140.777 7.04102C145.133 7.04102 147.84 10.5723 147.523 15.3511H137.034C137.267 17.952 139.128 19.1996 140.904 19.1996ZM144.435 12.9617C144.33 10.7837 142.659 9.43044 140.798 9.43044C139.339 9.43044 137.267 10.2551 137.056 12.9617H144.435Z" fill="#F5F5F7" style={{mixBlendMode: "difference"}}/>
            <path d="M159.093 12.1373C158.776 10.6783 157.529 9.53643 155.773 9.53643C153.807 9.53643 152.031 10.9955 152.031 14.3153C152.031 17.6351 153.807 19.0941 155.668 19.0941C157.233 19.0941 158.776 18.3752 159.093 16.4933H162.117C161.504 19.8131 158.586 21.695 155.562 21.695C151.502 21.695 148.711 18.4809 148.711 14.3153C148.711 10.1496 151.418 6.93555 155.668 6.93555C158.776 6.93555 161.483 8.90207 162.011 12.1373H159.093Z" fill="#F5F5F7" style={{mixBlendMode: "difference"}}/>
            <path d="M167.72 3.61719V7.35992H170.532V9.64362H167.72V17.3405C167.72 18.7996 168.037 19.1167 169.39 19.1167H170.532V21.5062H168.248C165.225 21.5062 164.611 20.6815 164.611 17.7634V9.53789H162.539V7.35992H164.611V3.61719H167.72Z" fill="#F5F5F7" style={{mixBlendMode: "difference"}}/>
            <path d="M175.71 5.58298H172.602V2.47461H175.71V5.58298ZM175.71 21.4843H172.602V7.35919H175.71V21.4843Z" fill="#F5F5F7" style={{mixBlendMode: "difference"}}/>
            <path d="M184.66 21.8024C181.234 21.8024 177.703 19.5187 177.703 14.4227C177.703 9.32667 181.234 7.04297 184.66 7.04297C188.085 7.04297 191.617 9.32667 191.617 14.4227C191.723 19.5187 188.191 21.8024 184.66 21.8024ZM188.403 14.4227C188.403 11.2086 186.626 9.53812 184.66 9.53812C182.693 9.53812 180.917 11.1029 180.917 14.4227C180.917 17.6368 182.693 19.3073 184.66 19.3073C186.626 19.2016 188.403 17.6368 188.403 14.4227Z" fill="#F5F5F7" style={{mixBlendMode: "difference"}}/>
            <path d="M201.173 7.04297C204.599 7.04297 205.952 9.22094 205.952 12.6465V21.4853H202.843V13.3866C202.843 11.5258 202.526 9.64385 200.137 9.64385C197.747 9.64385 196.817 11.5046 196.817 13.9998V21.4853H193.688V7.36015H196.796V9.32667C197.642 7.76191 199.206 7.04297 201.173 7.04297Z" fill="#F5F5F7" style={{mixBlendMode: "difference"}}/>
            <path d="M19.5117 0L4.96364 6.95683L4.85792 6.99912L4.92135 6.89339L7.28963 1.43789H4.39272L0.015625 11.5031L0.31166 12.1374L14.902 5.15947L15.0077 5.09604L14.9654 5.20176L9.02355 18.185L8.98126 18.2696L8.93897 18.185L6.23236 12.3066L3.84294 13.4696L8.64294 23.9366H9.31959L19.9769 0.676652L19.5117 0Z" fill="#F5F5F7" style={{mixBlendMode: "difference"}}/>
          </g>
          <defs>
            <clipPath id="clip0_5445_8731">
              <rect width="217" height="24" fill="white"/>
            </clipPath>
          </defs>
        </svg>
      </div>
      <nav className="flex-1 p-4 space-y-1">
        {menuItems.map((item) => {
          const isActive = pathname === item.href;
          return (
            <Link
              key={item.href}
              href={item.href}
              className={`flex items-center justify-between px-4 py-2.5 rounded-md text-sm font-medium transition-colors ${
                isActive
                  ? "bg-[#6295ff] text-white"
                  : "text-zinc-300 hover:bg-zinc-800 hover:text-white"
              }`}
            >
              <div className="flex items-center gap-3">
                <span>{item.icon}</span>
                <span>{item.name}</span>
              </div>
              {item.badge !== null && item.badge !== undefined && (
                <span className="bg-zinc-800 text-zinc-300 text-xs px-2 py-0.5 rounded-full">
                  {item.badge}
                </span>
              )}
            </Link>
          );
        })}
      </nav>
    </aside>
  );
}

